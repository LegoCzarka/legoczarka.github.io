<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Zestawy LEGO Czarka</title>

  <style>
    :root{
      --bg:#070B14;
      --panel:#0E1630;
      --panel2:#0B1226;
      --text:#EAF0FF;
      --muted:rgba(234,240,255,.70);

      --lego-red:#E3000B;
      --lego-yellow:#FFD400;
      --lego-blue:#006DB7;
      --lego-green:#00A651;

      --stroke:rgba(255,255,255,.10);
      --shadow: 0 14px 40px rgba(0,0,0,.45);
      --r-xl: 22px;
      --r-lg: 18px;
      --r-md: 14px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
      background:
        radial-gradient(1000px 700px at 15% -10%, rgba(227,0,11,.25), transparent 60%),
        radial-gradient(1000px 700px at 85% 10%, rgba(255,212,0,.20), transparent 60%),
        radial-gradient(1000px 700px at 50% 115%, rgba(0,109,183,.18), transparent 60%),
        var(--bg);
      color: var(--text);
    }

    /* LEGO-studs pattern */
    .studs{
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:.18;
      background-image:
        radial-gradient(circle at 10px 10px, rgba(255,255,255,.12) 0 3px, transparent 4px),
        radial-gradient(circle at 10px 10px, rgba(0,0,0,.25) 0 4px, transparent 5px);
      background-size: 34px 34px;
      mix-blend-mode: overlay;
      filter: blur(.2px);
    }

    .container{
      max-width: 1160px;
      margin: 0 auto;
      padding: 18px 18px 44px;
    }

    .hero{
      border:1px solid var(--stroke);
      border-radius: var(--r-xl);
      padding: 22px 18px 18px;
      background:
        linear-gradient(180deg, rgba(14,22,48,.86), rgba(11,18,38,.78));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }

    .hero::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        linear-gradient(90deg, rgba(227,0,11,.55), transparent 25%),
        linear-gradient(180deg, rgba(255,212,0,.35), transparent 40%),
        linear-gradient(270deg, rgba(0,109,183,.40), transparent 30%);
      opacity:.20;
      pointer-events:none;
    }

    .heroTop{
      display:flex;
      gap:16px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
      position:relative;
    }

    h1{
      margin:0;
      font-size: 30px;
      letter-spacing:.2px;
    }

    .subtitle{
      margin-top:6px;
      color: var(--muted);
      font-size: 14px;
    }

    .badges{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:14px;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      font-size: 13px;
      color: var(--muted);
      backdrop-filter: blur(6px);
    }
    .dot{width:9px;height:9px;border-radius:50%}
    .dot.red{background:var(--lego-red)}
    .dot.yellow{background:var(--lego-yellow)}
    .dot.blue{background:var(--lego-blue)}
    .dot.green{background:var(--lego-green)}

    .toolbar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-top: 16px;
      position:relative;
    }

    .searchWrap{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      width:100%;
    }

    .input, .select, .btn{
      border-radius: 14px;
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 11px 12px;
      outline:none;
      font-size: 14px;
      backdrop-filter: blur(6px);
    }
    .input{
      flex: 1;
      min-width: 250px;
    }
    .select{min-width: 170px}

    .btn{
      cursor:pointer;
      font-weight: 700;
      transition: transform .08s ease, background .2s ease, filter .2s ease;
    }
    .btn:hover{transform: translateY(-1px); filter: brightness(1.03);}
    .btn:active{transform: translateY(0px)}
    .btn.primary{
      background: linear-gradient(90deg, rgba(227,0,11,.95), rgba(255,212,0,.70));
      border-color: rgba(255,255,255,.18);
      color:#12030a;
    }

    .section{
      margin-top: 18px;
    }
    .sectionTitle{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      margin: 22px 0 10px;
      padding: 0 2px;
    }
    .sectionTitle h2{
      margin:0;
      font-size: 18px;
      letter-spacing:.2px;
    }
    .sectionTitle .desc{
      color: var(--muted);
      font-size: 13px;
    }

    .grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 14px;
    }

    .card{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(14,22,48,.85), rgba(11,18,38,.78));
      border-radius: var(--r-lg);
      box-shadow: var(--shadow);
      overflow:hidden;
      transition: transform .18s ease, border-color .18s ease;
      position:relative;
    }
    .card:hover{
      transform: translateY(-3px);
      border-color: rgba(255,255,255,.18);
    }

    .imgBox{
      width:100%;
      aspect-ratio: 4 / 3;
      background:
        radial-gradient(500px 250px at 30% 20%, rgba(255,212,0,.25), transparent 60%),
        radial-gradient(500px 250px at 70% 80%, rgba(0,109,183,.22), transparent 60%),
        rgba(0,0,0,.25);
      position:relative;
      padding: 10px;
    }

    /* âœ… zdjÄ™cie ma siÄ™ ZMIEJSZAÄ† i mieÅ›ciÄ‡ w okienku */
    .imgBox img{
      width:100%;
      height:100%;
      object-fit: contain;
      display:block;
      border-radius: 12px;
      background: rgba(255,255,255,.03);
    }

    .content{
      padding: 12px 12px 14px;
    }

    .titleRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }

    .name{
      font-weight: 900;
      margin:0 0 6px;
      font-size: 15px;
      line-height: 1.2;
    }

    .setnum{
      font-size: 12px;
      color: var(--muted);
      border: 1px solid var(--stroke);
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.04);
      white-space:nowrap;
    }

    .meta{
      margin-top: 6px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      font-size: 13px;
      color: var(--muted);
      line-height: 1.35;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 6px 9px;
      border-radius: 999px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
    }

    .linkRow{
      margin-top: 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    /* âœ… Å‚adny przycisk do Rebrickable */
    .rbBtn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(90deg, rgba(0,109,183,.90), rgba(0,166,81,.55));
      color: #081021;
      text-decoration:none;
      font-weight: 900;
      font-size: 13px;
      white-space:nowrap;
      transition: transform .08s ease, filter .2s ease;
    }
    .rbBtn:hover{ transform: translateY(-1px); filter: brightness(1.05); }
    .rbBtn:active{ transform: translateY(0px); }

    footer{
      color: var(--muted);
      font-size: 12px;
      margin-top: 18px;
      opacity:.85;
      text-align:center;
    }

    .empty{
      padding: 16px;
      border-radius: var(--r-lg);
      border:1px dashed rgba(255,255,255,.18);
      color: var(--muted);
      margin-top: 14px;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="studs"></div>

  <div class="container">
    <section class="hero">
      <div class="heroTop">
        <div>
          <h1>ðŸ§± Zestawy LEGO Czarka</h1>
          <div class="subtitle">Lista zestawÃ³w ktÃ³re posiada Czarek</div>

          <div class="badges" id="badges">
            <span class="badge"><span class="dot red"></span><span id="countC">Czarek (2000+): â€“</span></span>
            <span class="badge"><span class="dot green"></span><span id="countM">Mateusz (&lt;2000): â€“</span></span>
            <span class="badge"><span class="dot yellow"></span><span id="partsAll">CzÄ™Å›ci: â€“</span></span>
            <span class="badge"><span class="dot blue"></span><span id="updated">Aktualizacja: â€“</span></span>
          </div>
        </div>

        <button class="btn primary" id="refreshBtn" title="PrzeÅ‚aduj dane">OdÅ›wieÅ¼ ðŸ”„</button>
      </div>

      <div class="toolbar">
        <div class="searchWrap">
          <input class="input" id="q" placeholder="Szukaj: nazwa / numer zestawu / theme..." />
          <select class="select" id="sort">
            <option value="new">Najnowsze</option>
            <option value="old">Najstarsze</option>
            <option value="parts">NajwiÄ™cej czÄ™Å›ci</option>
            <option value="name">Nazwa Aâ†’Z</option>
          </select>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="sectionTitle">
        <h2>ðŸ§± Zestawy Czarka (od 2000 roku)</h2>
        <div class="desc">Nowoczesna kolekcja</div>
      </div>

      <div id="gridC" class="grid"></div>
      <div id="emptyC" class="empty" style="display:none">Brak wynikÃ³w w tej sekcji.</div>
    </section>

    <section class="section">
      <div class="sectionTitle">
        <h2>ðŸ§± Klocki Mateusza</h2>
        <div class="desc">Zestawy sprzed 2000 roku</div>
      </div>

      <div id="gridM" class="grid"></div>
      <div id="emptyM" class="empty" style="display:none">Brak wynikÃ³w w tej sekcji.</div>
    </section>

    <footer>Made for Czarek â€¢ GitHub Pages + Rebrickable</footer>
  </div>

<script>
const YEAR_SPLIT = 2000;

function fmtNumber(n){
  if (n == null || isNaN(n)) return "â€“";
  return new Intl.NumberFormat("pl-PL").format(n);
}

function sortSets(arr, mode){
  const a = [...arr];
  if (mode === "new") {
    a.sort((x,y) => (y.year||0) - (x.year||0) || (""+y.set_num).localeCompare(""+x.set_num));
  } else if (mode === "old") {
    a.sort((x,y) => (x.year||0) - (y.year||0) || (""+x.set_num).localeCompare(""+y.set_num));
  } else if (mode === "parts") {
    a.sort((x,y) => (y.num_parts||0) - (x.num_parts||0));
  } else if (mode === "name") {
    a.sort((x,y) => (x.name||"").localeCompare(y.name||"", "pl", {sensitivity:"base"}));
  }
  return a;
}

function filterByQuery(arr, q){
  const s = (q || "").toLowerCase().trim();
  if (!s) return arr;
  return arr.filter(x => {
    const hay = `${x.set_num} ${x.name||""} ${x.theme_name||""}`.toLowerCase();
    return hay.includes(s);
  });
}

function sumParts(arr){
  return arr.reduce((acc, x) => acc + (Number(x.num_parts)||0) * (Number(x.quantity)||1), 0);
}

function cardHTML(x){
  const safeTitle = (x.name||x.set_num||"").replace(/"/g,'&quot;');
  return `
    <article class="card">
      <div class="imgBox">
        ${x.set_img_url ? `<img src="${x.set_img_url}" alt="${safeTitle}" loading="lazy" onerror="this.style.display='none'">` : ""}
      </div>
      <div class="content">
        <div class="titleRow">
          <h3 class="name">${x.name || x.set_num}</h3>
          <span class="setnum">${x.set_num}</span>
        </div>

        <div class="meta">
          <span class="pill">ðŸ“… ${x.year ?? "â€“"}</span>
          <span class="pill">ðŸ§© ${fmtNumber(x.num_parts)}</span>
          <span class="pill">ðŸ“¦ x${x.quantity ?? 1}</span>
          ${x.theme_name ? `<span class="pill">ðŸŽ¨ ${x.theme_name}</span>` : ""}
        </div>

        <div class="linkRow">
          ${x.set_url ? `<a class="rbBtn" href="${x.set_url}" target="_blank" rel="noopener">PrzejdÅº do Rebrickable â†’</a>` : "<span></span>"}
          <span style="color:rgba(234,240,255,.55);font-size:12px"></span>
        </div>
      </div>
    </article>
  `;
}

async function load() {
  const res = await fetch("./data/sets.json?ts=" + Date.now());
  if (!res.ok) {
    document.getElementById("gridC").innerHTML = "";
    document.getElementById("gridM").innerHTML = "";
    document.getElementById("emptyC").style.display = "block";
    document.getElementById("emptyC").textContent =
      "Brak danych sets.json â€” uruchom Actions â†’ Run workflow aby pobraÄ‡ zestawy z Rebrickable.";
    document.getElementById("emptyM").style.display = "none";
    return;
  }

  const data = await res.json();
  const sets = Array.isArray(data.sets) ? data.sets : [];

  const qEl = document.getElementById("q");
  const sortEl = document.getElementById("sort");

  const gridC = document.getElementById("gridC");
  const gridM = document.getElementById("gridM");

  const emptyC = document.getElementById("emptyC");
  const emptyM = document.getElementById("emptyM");

  function apply(){
    const q = qEl.value || "";
    const sortMode = sortEl.value;

    const czarekAll = sets.filter(x => (x.year ?? 0) >= YEAR_SPLIT);
    const mateuszAll = sets.filter(x => (x.year ?? 0) < YEAR_SPLIT);

    const czarekF = sortSets(filterByQuery(czarekAll, q), sortMode);
    const mateuszF = sortSets(filterByQuery(mateuszAll, q), sortMode);

    document.getElementById("countC").textContent = `Czarek (2000+): ${czarekF.length}`;
    document.getElementById("countM").textContent = `Mateusz (<2000): ${mateuszF.length}`;
    document.getElementById("partsAll").textContent = `CzÄ™Å›ci: ${fmtNumber(sumParts(czarekF) + sumParts(mateuszF))}`;
    document.getElementById("updated").textContent = `Aktualizacja: ${data.generated_at || "â€“"}`;

    gridC.innerHTML = czarekF.map(cardHTML).join("");
    gridM.innerHTML = mateuszF.map(cardHTML).join("");

    emptyC.style.display = czarekF.length ? "none" : "block";
    emptyM.style.display = mateuszF.length ? "none" : "block";
  }

  qEl.addEventListener("input", apply);
  sortEl.addEventListener("change", apply);
  apply();
}

document.getElementById("refreshBtn").addEventListener("click", load);
load();
</script>
</body>
</html>
